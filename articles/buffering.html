<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Buffering • spatialsample</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Buffering">
<script defer data-domain="spatialsample.tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">spatialsample</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.6.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/spatialsample.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/buffering.html">Buffering</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidymodels/spatialsample/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Buffering</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/spatialsample/blob/v0.6.0/vignettes/articles/buffering.Rmd" class="external-link"><code>vignettes/articles/buffering.Rmd</code></a></small>
      <div class="d-none name"><code>buffering.Rmd</code></div>
    </div>

    
    
<p>The goal of spatialsample is to provide functions and classes for
spatial resampling to use with <a href="https://rsample.tidymodels.org/" class="external-link">rsample</a>. Keeping the data
used to train a spatial model (what we call a training or analysis set)
separate from the data used to evaluate that model (what we call a
testing or assessment set) provides a more realistic view of how well it
will perform when extrapolating to new locations.</p>
<p>When resampling spatial data, we often want to introduce some
distance between analysis and assessment data; one of the most common
methods for introducing this distance is to “buffer” the assessment set,
removing all points within a given distance from the analysis set to
enforce a minimum space between data sets. This vignette walks through
how to buffer your assessment folds with spatialsample, as well as some
considerations about how those buffers are calculated.</p>
<p>To begin, let’s load spatialsample:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/spatialsample" class="external-link">spatialsample</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="exclusion-buffers">Exclusion buffers<a class="anchor" aria-label="anchor" href="#exclusion-buffers"></a>
</h2>
<p>By default, most spatial cross-validation methods in spatialsample
don’t automatically create buffer zones. Take for instance
<code><a href="../reference/spatial_block_cv.html">spatial_block_cv()</a></code>, which creates a number of “blocks” in a
grid and assigns data to folds based on the block its centroid falls
in:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">blocks</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spatial_block_cv.html">spatial_block_cv</a></span><span class="op">(</span><span class="va">boston_canopy</span>, v <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">blocks</span><span class="op">)</span></span></code></pre></div>
<p><img src="buffering_files/figure-html/boston-block-1.png" width="768"></p>
<p>If we look at the individual folds, we can see that the assessment
data directly borders the analysis data for each given fold:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">walk</a></span><span class="op">(</span><span class="va">blocks</span><span class="op">$</span><span class="va">splits</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="buffering_files/figure-html/boston-block-gif-.gif" width="768"></p>
<p>This is a downside of standard blocking cross-validation approaches;
while it does introduce some spatial separation between the analysis and
assessment sets for data at the middle of the block, data towards the
edges may not be separated at all.</p>
<p>Applying an exclusion buffer around each assessment fold lets us
change that. To create these exclusion buffers while using any
cross-validation function in spatialsample, we can use a standardized
<code>buffer</code> argument:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">blocks</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spatial_block_cv.html">spatial_block_cv</a></span><span class="op">(</span><span class="va">boston_canopy</span>, v <span class="op">=</span> <span class="fl">5</span>, buffer <span class="op">=</span> <span class="fl">1500</span><span class="op">)</span></span></code></pre></div>
<p>Now when we plot the folds separately, we can see that a strip of
data around each assessment block has been assigned to neither the
analysis or assessment fold. Instead, it’s been removed entirely in
order to provide some distance between the two sets:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">walk</a></span><span class="op">(</span><span class="va">blocks</span><span class="op">$</span><span class="va">splits</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="buffering_files/figure-html/boston-block-buffer-gif-.gif" width="768"></p>
<p>By default, <code>buffer</code> is assumed to be in the same units as
your data, as determined by the data’s coordinate reference system. To
apply buffers of other units, use the <code>units</code> package to
explicitly specify what units your buffer is in.</p>
<p>For instance, <code>boston_canopy</code> uses units of US feet for
distance. To specify a buffer in meters instead, we can use:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">blocks</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spatial_block_cv.html">spatial_block_cv</a></span><span class="op">(</span></span>
<span>  <span class="va">boston_canopy</span>,</span>
<span>  v <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  buffer <span class="op">=</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html" class="external-link">as_units</a></span><span class="op">(</span><span class="fl">1500</span>, <span class="st">"m"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">walk</a></span><span class="op">(</span><span class="va">blocks</span><span class="op">$</span><span class="va">splits</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="buffering_files/figure-html/boston-block-buffer-m-gif-.gif" width="768"></p>
<p>Note that, when you’re using non-point data, the distance between
observations is calculated as the shortest distance between any points
in two observations. For instance, buffers on polygon data will exclude
data based on the edge-to-edge distance between observations, rather
than centroid to centroid.</p>
<p>One special case, however, is when <code>buffer</code> is set to 0.
In this case, spatialsample won’t apply a buffer at all. While polygons
that share an edge are within 0 distance of each other, when calculated
from edge-to-edge, we think that setting <code>buffer = 0</code> would
intuitively apply zero (that is, <em>no</em>) buffer. If you want to be
sure to only capture adjacent polygons in a buffer, set
<code>buffer</code> to a tiny, non-zero value:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">blocks</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spatial_block_cv.html">spatial_block_cv</a></span><span class="op">(</span></span>
<span>  <span class="va">boston_canopy</span>,</span>
<span>  v <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  buffer <span class="op">=</span> <span class="fl">2e-200</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">walk</a></span><span class="op">(</span><span class="va">blocks</span><span class="op">$</span><span class="va">splits</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="buffering_files/figure-html/boston-block-buffer-eps-gif-.gif" width="768"></p>
</div>
<div class="section level2">
<h2 id="inclusion-radii">Inclusion radii<a class="anchor" aria-label="anchor" href="#inclusion-radii"></a>
</h2>
<p>In addition to exclusion buffers, spatialsample also provides a way
to add an <em>inclusion</em> buffer (or as we call it, an “inclusion
radius”) around your assessment set. Simply set the <code>radius</code>
argument in any spatial cross-validation function to your desired
distance, and any data within that inclusion radius will be added to the
assessment set:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">blocks</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spatial_block_cv.html">spatial_block_cv</a></span><span class="op">(</span></span>
<span>  <span class="va">boston_canopy</span>,</span>
<span>  v <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  radius <span class="op">=</span> <span class="fl">2e-200</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">walk</a></span><span class="op">(</span><span class="va">blocks</span><span class="op">$</span><span class="va">splits</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="buffering_files/figure-html/boston-block-radius-eps-gif-.gif" width="768"></p>
<p>This argument is handled the same way as <code>buffer</code>, with
the same caveats:</p>
<ul>
<li>Unless units are specified explicitly, <code>radius</code> is
assumed to be in the same units as your data’s coordinate reference
system.</li>
<li>Distances are calculated between the closest parts of
observations.</li>
<li>Values of zero do not apply a radius.</li>
</ul>
<p>Both <code>radius</code> and <code>buffer</code> can be specified at
the same time. This makes it possible to implement, for instance,
leave-one-disc-out cross-validation using spatialsample:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">blocks</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spatial_vfold.html">spatial_buffer_vfold_cv</a></span><span class="op">(</span></span>
<span>  <span class="va">boston_canopy</span>,</span>
<span>  v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">boston_canopy</span><span class="op">)</span>,</span>
<span>  radius <span class="op">=</span> <span class="fl">1500</span>,</span>
<span>  buffer <span class="op">=</span> <span class="fl">1500</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">walk</a></span><span class="op">(</span><span class="va">blocks</span><span class="op">$</span><span class="va">splits</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="buffering_files/figure-html/boston-block-disc-executed-.gif" width="768"></p>
<p>When both <code>radius</code> and <code>buffer</code> are specified,
spatialsample first applies the inclusion radius to the original
randomly-selected assessment set, adding any data within the radius to
the assessment set. Next, the exclusion buffer is applied to all the
points in the new (post-radius) assessment set, removing any data within
the buffer from the analysis set.</p>
<p>Note that this means that <code>buffer</code> is <em>not</em> simply
applying a “doughnut” around the circular “radius”, but is buffering
each test point separately. See for instance the non-uniform buffer
region that happens when there’s a gap in the data:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">blocks</span><span class="op">$</span><span class="va">splits</span><span class="op">[[</span><span class="fl">12</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="buffering_files/figure-html/boston-both-1.png" width="768"></p>
<p>This leaves more data in your analysis set for fitting the model,
while still ensuring your assessment data is spatially removed.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.mm218.dev/" class="external-link">Michael Mahoney</a>, <a href="https://juliasilge.com/" class="external-link">Julia Silge</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer>
</body>
</html>
