<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="spatialsample">
<title>Using spatial resamples for analysis • spatialsample</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.5/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.5/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using spatial resamples for analysis">
<meta property="og:description" content="spatialsample">
<meta property="og:image" content="https://spatialsample.tidymodels.org/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="spatialsample.tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-none"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">spatialsample</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.3.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/spatialsample.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/buffering.html">Buffering</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tidymodels/spatialsample/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Using spatial resamples for analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/spatialsample/blob/HEAD/vignettes/spatialsample.Rmd" class="external-link"><code>vignettes/spatialsample.Rmd</code></a></small>
      <div class="d-none name"><code>spatialsample.Rmd</code></div>
    </div>

    
    
<p>The resampled objects created by spatialsample can be used in many of
the same ways that those created by <a href="https://rsample.tidymodels.org/" class="external-link">rsample</a> can, from making
comparisons to evaluating models. These objects can be used together
with other parts of the <a href="https://www.tidymodels.org/" class="external-link">tidymodels</a> framework, but let’s
walk through a more basic example using linear modeling of housing data
from Ames, IA.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"ames"</span>, package <span class="op">=</span> <span class="st">"modeldata"</span><span class="op">)</span></span></code></pre></div>
<p>The Ames housing data is a normal <a href="https://tibble.tidyverse.org/" class="external-link">tibble</a>. While many of the
functions in spatialsample support standard tibbles, several require
that our data be an <a href="https://r-spatial.github.io/sf/" class="external-link">sf</a>
object to properly handle spatial distance calculations. We can
transform our Ames data into an sf object using the
<code><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">sf::st_as_sf()</a></code> function:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ames_sf</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span></span>
<span>  <span class="va">ames</span>,</span>
<span>  <span class="co"># "coords" is in x/y order -- so longitude goes first!</span></span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Longitude"</span>, <span class="st">"Latitude"</span><span class="op">)</span>,</span>
<span>  <span class="co"># Set our coordinate reference system to EPSG:4326,</span></span>
<span>  <span class="co"># the standard WGS84 geodetic coordinate reference system</span></span>
<span>  crs <span class="op">=</span> <span class="fl">4326</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>For this vignette, we’ll model the sale prices of the houses in the
Ames data set. Let’s say that the sale price of these houses depends on
the year they were built, their living area (size), and the type of
house they are (duplex vs. townhouse vs. single family), along with
perhaps interactions between type and house size.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">Sale_Price</span><span class="op">)</span> <span class="op">~</span> <span class="va">Year_Built</span> <span class="op">+</span> <span class="va">Gr_Liv_Area</span> <span class="op">+</span> <span class="va">Bldg_Type</span></span></code></pre></div>
<p>This relationship may exhibit spatial autocorrelation across the city
of Ames, and we can use any of the several different methods provided by
spatialsample to try and investigate it.</p>
<p>For instance, we could create <code>v = 15</code> spatial
cross-validation folds with <code><a href="../reference/spatial_clustering_cv.html">spatial_clustering_cv()</a></code>, which
<a href="https://doi.org/10.1109/IGARSS.2012.6352393" class="external-link">uses k-means
clustering in order to divide the data into folds</a>. We can then
visualize those folds using the <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot()</a></code> function from
spatialsample:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/spatialsample" class="external-link">spatialsample</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">cluster_folds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spatial_clustering_cv.html">spatial_clustering_cv</a></span><span class="op">(</span><span class="va">ames_sf</span>, v <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">cluster_folds</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatialsample_files/figure-html/unnamed-chunk-6-1.png" width="768"></p>
<p>Our <code>cluster_folds</code> object is an <code>rset</code> object
that contains many resamples or <code>rsplit</code> objects in the
<code>splits</code> column. The resulting partitions do not necessarily
contain an equal number of observations:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cluster_folds</span></span>
<span><span class="co">#&gt; #  15-fold spatial cross-validation </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 15 × 2</span></span></span>
<span><span class="co">#&gt;    splits             id    </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> <span style="color: #949494;">&lt;split [2797/133]&gt;</span> Fold01</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> <span style="color: #949494;">&lt;split [2724/206]&gt;</span> Fold02</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> <span style="color: #949494;">&lt;split [2777/153]&gt;</span> Fold03</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> <span style="color: #949494;">&lt;split [2830/100]&gt;</span> Fold04</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> <span style="color: #949494;">&lt;split [2836/94]&gt;</span>  Fold05</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> <span style="color: #949494;">&lt;split [2759/171]&gt;</span> Fold06</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> <span style="color: #949494;">&lt;split [2560/370]&gt;</span> Fold07</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> <span style="color: #949494;">&lt;split [2810/120]&gt;</span> Fold08</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> <span style="color: #949494;">&lt;split [2715/215]&gt;</span> Fold09</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> <span style="color: #949494;">&lt;split [2776/154]&gt;</span> Fold10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> <span style="color: #949494;">&lt;split [2778/152]&gt;</span> Fold11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> <span style="color: #949494;">&lt;split [2695/235]&gt;</span> Fold12</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> <span style="color: #949494;">&lt;split [2750/180]&gt;</span> Fold13</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> <span style="color: #949494;">&lt;split [2496/434]&gt;</span> Fold14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> <span style="color: #949494;">&lt;split [2717/213]&gt;</span> Fold15</span></span></code></pre></div>
<p>But while spatial clustering is <em>a</em> method for spatial
cross-validation using spatialsample, it is not the only method
available. The other methods are broadly similar, breaking the data into
a number of (not necessarily even) folds based on spatial
arrangement.</p>
<p>For instance, the <code><a href="../reference/spatial_block_cv.html">spatial_block_cv()</a></code> function will
perform <a href="https://doi.org/10.1111/ecog.02881" class="external-link">spatial
blocking</a> with your data:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">block_folds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spatial_block_cv.html">spatial_block_cv</a></span><span class="op">(</span><span class="va">ames_sf</span>, v <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">block_folds</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatialsample_files/figure-html/unnamed-chunk-8-1.png" width="768"></p>
<p>If you already have a sense of what locations in your data are likely
to be closely related, you can also use the
<code><a href="../reference/spatial_vfold.html">spatial_leave_location_out_cv()</a></code> function to perform <a href="https://doi.org/10.1016/j.envsoft.2017.12.001" class="external-link">leave-location-out
cross-validation</a>. For instance, we can split the Ames data into
folds based on neighborhoods using this function:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">location_folds</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/spatial_vfold.html">spatial_leave_location_out_cv</a></span><span class="op">(</span></span>
<span>    <span class="va">ames_sf</span>,</span>
<span>    group <span class="op">=</span> <span class="va">Neighborhood</span>,</span>
<span>    v <span class="op">=</span> <span class="fl">15</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">location_folds</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatialsample_files/figure-html/unnamed-chunk-9-1.png" width="768"></p>
<p>We’ve now got a lot of different resamples floating around! We’re
going to fit the same models to each of them, in the same way, using the
same code. In order to make that task a little easier, let’s add a new
column named <code>type</code> to signal what type of resample each fold
is from, and then combine them into a new data frame:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cluster_folds</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"cluster"</span></span>
<span><span class="va">block_folds</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"block"</span></span>
<span><span class="va">location_folds</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"location"</span></span>
<span></span>
<span><span class="va">resamples</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>    <span class="va">cluster_folds</span>,</span>
<span>    <span class="va">block_folds</span>,</span>
<span>    <span class="va">location_folds</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Now let’s write a function that will, for each resample:</p>
<ul>
<li>obtain the <em>analysis</em> set for model fitting</li>
<li>fit a linear model with a interaction term</li>
<li>predict the <em>assessment</em> set and return both the true and
predicted price, on the log scale</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># `splits` will be the `rsplit` object</span></span>
<span><span class="va">compute_preds</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">splits</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># fit the model to the analysis set</span></span>
<span>  <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">Sale_Price</span><span class="op">)</span> <span class="op">~</span> <span class="va">Year_Built</span> <span class="op">+</span> <span class="va">Bldg_Type</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">Gr_Liv_Area</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/as.data.frame.rsplit.html" class="external-link">analysis</a></span><span class="op">(</span><span class="va">splits</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="co"># identify the assessment set</span></span>
<span>  <span class="va">holdout</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/as.data.frame.rsplit.html" class="external-link">assessment</a></span><span class="op">(</span><span class="va">splits</span><span class="op">)</span></span>
<span>  <span class="co"># return the assessment set, with true and predicted price</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    geometry <span class="op">=</span> <span class="va">holdout</span><span class="op">$</span><span class="va">geometry</span>,</span>
<span>    Sale_Price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">holdout</span><span class="op">$</span><span class="va">Sale_Price</span><span class="op">)</span>,</span>
<span>    .pred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">holdout</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We can apply this function to just one of the
<code>splits</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">compute_preds</span><span class="op">(</span><span class="va">cluster_folds</span><span class="op">$</span><span class="va">splits</span><span class="op">[[</span><span class="fl">7</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 370 × 3</span></span></span>
<span><span class="co">#&gt;                geometry Sale_Price .pred</span></span>
<span><span class="co">#&gt;             <span style="color: #949494; font-style: italic;">&lt;POINT [°]&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> (-93.67907 42.03608)       4.83  4.99</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> (-93.67721 42.03654)       5.05  5.20</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> (-93.67367 42.03479)       5.17  5.14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> (-93.67096 42.03569)       5.14  5.06</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  (-93.6721 42.03486)       5.09  5.07</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> (-93.67207 42.03457)       5.12  5.11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> (-93.66969 42.03533)       5.10  5.10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  (-93.66067 42.0346)       5.23  5.25</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> (-93.65921 42.03456)       5.12  5.26</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> (-93.65623 42.03345)       5.39  5.33</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 360 more rows</span></span></span></code></pre></div>
<p>Or we can apply this function to all of the <code>splits</code>,
using <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::map()</a></code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span></span>
<span><span class="va">cv_res</span> <span class="op">&lt;-</span> <span class="va">resamples</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>.preds <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">splits</span>, <span class="va">compute_preds</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can <code><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest()</a></code> these results and <a href="https://yardstick.tidymodels.org/reference/index.html#section-regression-metrics" class="external-link">use
yardstick to compute any regression metrics appropriate to this modeling
analysis</a>, such as <code><a href="https://yardstick.tidymodels.org/reference/rmse.html" class="external-link">yardstick::rmse()</a></code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/yardstick" class="external-link">yardstick</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">cv_rmse</span> <span class="op">&lt;-</span> <span class="va">cv_res</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">.preds</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">type</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://yardstick.tidymodels.org/reference/rmse.html" class="external-link">rmse</a></span><span class="op">(</span><span class="va">Sale_Price</span>, <span class="va">.pred</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cv_rmse</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 45 × 5</span></span></span>
<span><span class="co">#&gt;    id     type    .metric .estimator .estimate</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Fold01 block   rmse    standard      0.078<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Fold01 cluster rmse    standard      0.071<span style="text-decoration: underline;">5</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Fold02 block   rmse    standard      0.070<span style="text-decoration: underline;">5</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Fold02 cluster rmse    standard      0.104 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Fold03 block   rmse    standard      0.075<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Fold03 cluster rmse    standard      0.107 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Fold04 block   rmse    standard      0.096<span style="text-decoration: underline;">2</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Fold04 cluster rmse    standard      0.054<span style="text-decoration: underline;">2</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Fold05 block   rmse    standard      0.103 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Fold05 cluster rmse    standard      0.146 </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 35 more rows</span></span></span></code></pre></div>
<p>It looks like the RMSE may vary across the city, so we can join the
metrics back up to our results and plot them.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">cv_res</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">.preds</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">cv_rmse</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"type"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">.estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geometry</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"RMSE"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">type</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatialsample_files/figure-html/unnamed-chunk-15-1.png" width="768"></p>
<p>As you can see, the results you get are highly dependent on how you
resample your data! It’s important to use the right method for your data
(and, for methods like spatial blocking and buffered cross-validation,
the right distances).</p>
  </main>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://www.mm218.dev/" class="external-link">Michael Mahoney</a>, <a href="https://juliasilge.com/" class="external-link">Julia Silge</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

  </div></footer>
</body>
</html>
